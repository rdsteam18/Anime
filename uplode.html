<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8" />
    <title>Movies JSON अपडेट करें</title>
</head>
<body>

    <h2>नई मूवी जोड़ें</h2>
    <form id="movieForm">
        <label>ID: <input type="number" name="id" required></label><br><br>
        <label>Title: <input type="text" name="title" required></label><br><br>
        <label>Year: <input type="number" name="year" required></label><br><br>
        <label>Rating: <input type="number" name="rating" required></label><br><br>
        <label>Poster URL: <input type="url" name="poster" required></label><br><br>
        <label>Detail URL: <input type="url" name="detailUrl" required></label><br><br>

        <button type="submit">सबमिट करें</button>
    </form>

    <script>
        const token = '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';  // Step 1 में बनाया टोकन यहाँ डालें
const owner = 'rdsteam18';            // आपका GitHub यूजरनेम
const repo = 'Anime';                    // आपका रिपोजिटरी नाम
const branch = 'main';                            // आपका ब्रांच नाम (जैसे main या master)
const path = 'movies.json';                       // JSON फाइल का नाम/पाथ

document.getElementById('movieForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    // फॉर्म से डाटा लेना
    const formData = new FormData(e.target);
    const newMovie = {
        id: parseInt(formData.get('id')),
        title: formData.get('title'),
        year: parseInt(formData.get('year')),
        rating: parseInt(formData.get('rating')),
        poster: formData.get('poster'),
        detailUrl: formData.get('detailUrl')
    };

    try {
        // Step 3.1: GitHub से वर्तमान movies.json फाइल की कंटेंट और SHA लें
        const getFileResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`, {
            headers: {
                Authorization: `token ${token}`
            }
        });

        if (!getFileResponse.ok) throw new Error('GitHub से फाइल पढ़ने में समस्या हुई');

        const fileData = await getFileResponse.json();
        const content = atob(fileData.content);  // base64 डिकोड करें
        const sha = fileData.sha;

        // Step 3.2: JSON को पार्स करें, नई मूवी जोड़ें, फिर JSON स्ट्रिंग में बदलें
        const movies = JSON.parse(content);
        movies.push(newMovie);
        const updatedContent = JSON.stringify(movies, null, 4);

        // Step 3.3: GitHub API को PUT रिक्वेस्ट भेजें फाइल अपडेट करने के लिए
        const updateResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
            method: 'PUT',
            headers: {
                Authorization: `token ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: `नई मूवी जोड़ी: ${newMovie.title}`,
                content: btoa(unescape(encodeURIComponent(updatedContent))),
                sha: sha,
                branch: branch
            })
        });

        if (!updateResponse.ok) throw new Error('GitHub पर फाइल अपडेट करने में समस्या हुई');

        alert('movies.json सफलतापूर्वक अपडेट हो गया!');
        e.target.reset();

    } catch (error) {
        alert('त्रुटि: ' + error.message);
        console.error(error);
    }
});

    </script>

</body>
</html>
